<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Page - Order/Payment Confirmation Page</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f6f8fb;
    margin: 0;
    padding: 20px;
  }

  h1 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 20px;
  }

  .login-box {
    max-width: 360px;
    margin: 80px auto;
    padding: 25px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    text-align: center;
  }

  .login-box input {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    font-size: 15px;
  }

  .login-box button {
    width: 100%;
    padding: 10px;
    margin-top: 15px;
    background: #2d89ef;
    border: none;
    color: #fff;
    font-size: 16px;
    cursor: pointer;
    border-radius: 4px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
  }

  th, td {
    padding: 10px;
    border: 1px solid #ddd;
    font-size: 14px;
    text-align: center;
  }

  th {
    background: #2d89ef;
    color: #fff;
  }

  button.confirm-btn {
    background: #28a745;
    color: #fff;
    border: none;
    padding: 6px 10px;
    cursor: pointer;
    border-radius: 4px;
  }

  button.confirm-btn:disabled {
    background: #aaa;
    cursor: not-allowed;
  }
</style>
</head>

<body>

<h1>Admin Page - Order/Payment Confirmation Page</h1>

<!-- LOGIN -->
<div class="login-box" id="loginBox">
  <h3>Admin Login</h3>
  <input type="password" id="adminPassword" placeholder="Enter Admin Password">
  <button onclick="login()">Login</button>
</div>

<!-- ORDERS -->
<div id="ordersSection" style="display:none;">
  <table>
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Customer</th>
        <th>Phone Number</th>
        <th>Total Amount</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="ordersTable"></tbody>
  </table>
</div>

<script>
const ADMIN_PASSWORD = "Neev@Kart#Admin!2026$";
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz8NulIj3LlhKVYub6iuH_mWyxaZORCnLS78gGBcyDDFjvNEOyhks1JugddaA-3wmu4/exec";

function login() {
  const pwd = document.getElementById("adminPassword").value;
  if (pwd === ADMIN_PASSWORD) {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("ordersSection").style.display = "block";
    loadOrders();
  } else {
    alert("❌ Incorrect password");
  }
}

function loadOrders() {
  fetch(SCRIPT_URL + "?action=getOrders")
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("ordersTable");
      tbody.innerHTML = "";

      data.forEach(order => {

        // COLUMN MAPPING (MATCHES YOUR SHEET)
        //const orderId = order[0];   // A
        //const customer = order[2];  // C
        //const phone = order[3];     // D
        //const total = order[10];    // K
        //const status = order[14];   // O
        
        const orderId  = order[0];
        const customer = order[2];
        const phone    = order[3];
        const total    = order[10];
        const status   = order[14];

        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${orderId}</td>
          <td>${customer}</td>
          <td>${phone}</td>
          <td>₹${total}</td>
          <td>${status}</td>
          <td>
            <button class="confirm-btn"
              ${status === "CONFIRMED" ? "disabled" : ""}
              onclick="confirmOrder('${orderId}', event)">
              Confirm
            </button>
          </td>
        `;

        tbody.appendChild(tr);
      });
    });
}

function confirmOrder(orderId, event) {
  if (!confirm("Confirm payment for this order?")) return;

  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "confirmOrder",
      orderId: orderId
    })
  })

  .then(res => res.json())
  .then(resp => {
    if (resp.success === true) {
      alert("✅ Order confirmed – Payment confirmed");
  
      // remove row from UI
      const btn = event.target;
      const row = btn.closest("tr");
      row.remove();
    } else {
      alert("❌ Failed to confirm order");
    }
  })
  .catch(err => {
    console.error(err);
    alert("❌ Server error");
  });

}
</script>

</body>
</html>
